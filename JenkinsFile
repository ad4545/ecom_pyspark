pipeline {
  agent {
    kubernetes {
      namespace 'devops-tools'
      defaultContainer 'ci'
      yaml """
apiVersion: v1
kind: Pod
spec:
  serviceAccountName: jenkins-admin
  containers:
  - name: ci
    image: adarsh7r/ecom-pytest:latest
    command:
    - cat
    tty: true
    volumeMounts:
    - name: workspace
      mountPath: /home/jenkins/agent
  volumes:
  - name: workspace
    emptyDir: {}
"""
    }
  }
  stages {
    stage('Run in CI container') {
      steps {
        container('ci') {
          sh 'ls -la'
        }
      }
    }
  }
}